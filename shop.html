<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Store - Spot On</title>

  <!-- Orbitron Font & Bootstrap CSS -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Global Tron-like Styles */
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      font-family: 'Orbitron', sans-serif;
      color: #00ffff;
      background-color: #000;
      overflow-x: hidden;
    }
    /* Offcanvas Toggle Button (Optional) */
    #offcanvasToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
      background: none;
      border: none;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hamburger-icon {
      width: 30px;
      height: 22px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .hamburger-icon span {
      display: block;
      height: 4px;
      width: 100%;
      background-color: #00ffff;
      border-radius: 2px;
      box-shadow: 0 0 5px #00ffff;
    }
    /* Offcanvas Sidebar */
    .offcanvas {
      background-color: rgba(0, 0, 0, 0.95);
      border-left: 2px solid #00ffff;
    }
    .offcanvas-header,
    .offcanvas-body,
    .offcanvas-title {
      color: #00ffff;
    }
    .offcanvas .nav-link {
      color: #00ffff;
      border-bottom: 1px solid rgba(0, 255, 255, 0.2);
      padding: 0.75rem 1rem;
    }
    .offcanvas .nav-link:hover,
    .offcanvas .nav-link.active {
      background-color: rgba(0, 31, 63, 0.5);
    }
    /* Page Header (Tron-inspired) */
    .page-header {
      background: rgba(0, 31, 63, 0.85);
      border: 1px solid #00ffff;
      box-shadow: 0 0 10px #00ffff;
      color: #00ffff;
      padding: 2rem;
      border-radius: 0.5rem;
      margin-bottom: 2rem;
      text-align: center;
    }
    .page-header h1 {
      font-size: 2.5rem;
      margin: 0;
      text-shadow: 0 0 5px #00ffff;
    }
    .page-header p {
      font-size: 1.2rem;
      margin: 0;
      text-shadow: 0 0 3px #00ffff;
    }
    /* Store Grid */
    .store-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
      gap: 1rem;
    }
    /* Tron-inspired Store Item Cards */
    .store-item {
      background: rgba(0, 31, 63, 0.85);
      border: 1px solid #00ffff;
      box-shadow: 0 0 10px #00ffff;
      border-radius: 1rem;
      padding: 1.5rem;
      text-align: center;
      transition: transform 0.3s ease;
    }
    .store-item:hover {
      transform: translateY(-5px);
    }
    .store-title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #00ffff;
      text-shadow: 0 0 5px #00ffff;
    }
    .store-desc {
      color: #66ffff;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      text-shadow: 0 0 3px #00ffff;
    }
    .store-qty {
      color: #0f0; /* Neon green */
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    .store-link a {
      color: #00ff00;
      text-decoration: underline;
    }
    /* Pagination */
    .pagination-controls {
      text-align: center;
      margin-top: 1.5rem;
    }
    .pagination-controls button {
      margin: 0 0.5rem;
      min-width: 80px;
    }
  </style>
</head>
<body>

  <!-- Offcanvas Toggle (Optional) -->
  <button id="offcanvasToggle" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
    <div class="hamburger-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>

  <!-- Offcanvas Sidebar -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Spot On</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <nav class="navbar">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="mergedPins.html">Pins</a></li>
          <li class="nav-item"><a class="nav-link" href="events.html">Events</a></li>
          <li class="nav-item"><a class="nav-link" href="songs.html">Songs</a></li>
          <li class="nav-item"><a class="nav-link active" href="store.html">Store</a></li>
          <!-- Add your other links as needed -->
        </ul>
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container mt-5">
    <div class="page-header">
      <h1 class="display-5">Digital Store</h1>
      <p class="lead">Browse all available shop pins added by users.</p>
    </div>

    <!-- Grid Container -->
    <div id="storeGrid" class="store-grid"></div>

    <!-- Pagination Controls -->
    <div class="pagination-controls">
      <button class="btn btn-outline-light" id="prevPageBtn">Previous</button>
      <button class="btn btn-outline-light" id="nextPageBtn">Next</button>
      <span id="pageInfo" style="margin-left:10px;"></span>
    </div>
  </main>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_RTDB_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let allShopPins = [];
    let currentPage = 1;
    const pageSize = 20;

    const storeGrid = document.getElementById("storeGrid");
    const prevPageBtn = document.getElementById("prevPageBtn");
    const nextPageBtn = document.getElementById("nextPageBtn");
    const pageInfo = document.getElementById("pageInfo");

    // Pagination Buttons
    prevPageBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderShopPins();
      }
    });
    nextPageBtn.addEventListener("click", () => {
      currentPage++;
      renderShopPins();
    });

    onValue(ref(db, "pins"), snapshot => {
      allShopPins = [];

      const data = snapshot.val();
      if (!data) {
        storeGrid.innerHTML = "<p class='text-center text-muted'>No shop items available.</p>";
        return;
      }

      // Gather all shopPins from all users
      Object.values(data).forEach(userPins => {
        if (userPins.shopPins) {
          Object.values(userPins.shopPins).forEach(pin => {
            allShopPins.push(pin);
          });
        }
      });

      // (Optional) Sort by timestamp descending
      // allShopPins.sort((a,b) => b.timestamp - a.timestamp);

      currentPage = 1;
      renderShopPins();
    });

    function renderShopPins() {
      const totalItems = allShopPins.length;
      const totalPages = Math.ceil(totalItems / pageSize);

      // Keep currentPage in range
      if (currentPage > totalPages && totalPages > 0) {
        currentPage = totalPages;
      }
      if (currentPage < 1) currentPage = 1;

      // Slice the array
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = startIndex + pageSize;
      const pageItems = allShopPins.slice(startIndex, endIndex);

      // Render
      storeGrid.innerHTML = "";
      if (pageItems.length === 0) {
        storeGrid.innerHTML = "<p class='text-center text-muted'>No shop items on this page.</p>";
      } else {
        pageItems.forEach(item => {
          const card = document.createElement("div");
          card.className = "store-item";

          // Title
          const title = document.createElement("h5");
          title.className = "store-title";
          title.textContent = item.title || "Untitled Item";

          // Description
          const desc = document.createElement("p");
          desc.className = "store-desc";
          desc.textContent = item.description || "No description provided.";

          // Quantity
          const qty = document.createElement("div");
          qty.className = "store-qty";
          qty.textContent = `Quantity: ${item.quantity || 0}`;

          // Link (if any)
          const linkDiv = document.createElement("div");
          linkDiv.className = "store-link";
          if (item.link) {
            linkDiv.innerHTML = `Buy here: <a href="${item.link}" target="_blank">Open Link</a>`;
          }

          // Image (if any)
          if (item.imageUrl) {
            const img = document.createElement("img");
            img.src = item.imageUrl;
            img.alt = "Shop Item Image";
            img.style.maxWidth = "100%";
            img.style.borderRadius = "8px";
            img.style.border = "2px solid #00ffff";
            img.style.boxShadow = "0 0 5px #00ffff";
            img.style.marginBottom = "10px";
            card.appendChild(img);
          }

          // Append to card
          card.appendChild(title);
          card.appendChild(desc);
          card.appendChild(qty);
          if (item.link) {
            card.appendChild(linkDiv);
          }

          storeGrid.appendChild(card);
        });
      }

      // Update pagination UI
      pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
      prevPageBtn.disabled = (currentPage === 1);
      nextPageBtn.disabled = (currentPage === totalPages || totalPages === 0);
    }
  </script>

  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
