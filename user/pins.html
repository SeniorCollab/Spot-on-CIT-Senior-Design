<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pins - Spot On</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        /* Page background */
        body {
            padding-top: 60px;
            background-color: #f8f9fa;
            color: #343a40;
        }
        /* Offcanvas toggle button styling */
        #offcanvasToggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            border: none;
            background-color: #007bff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        #offcanvasToggle:hover {
            background-color: #0056b3;
        }
        /* Header banner */
        .page-header {
            background: linear-gradient(135deg, #6f42c1, #007bff);
            color: #fff;
            padding: 2rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        /* Pin list styling */
        .list-group-item {
            background-color: #fff;
            border: none;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .list-group-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .pin-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        .pin-actions .btn {
            min-width: 70px;
        }
    </style>
</head>
<body>
    <!-- Offcanvas Toggle Button (Hamburger Icon) -->
    <button class="btn" type="button" id="offcanvasToggle" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
        <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Offcanvas Sidebar for Navigation -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Spot On</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <nav class="navbar">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="pins.html">Pins</a></li>
                    <li class="nav-item"><a class="nav-link" href="songs.html">Songs</a></li>
                    <li class="nav-item"><a class="nav-link" href="events.html">Events</a></li>
                    <li class="nav-item"><a class="nav-link" href="shop.html">My Store</a></li>
                    <li class="nav-item"><a class="nav-link" href="admin/adminlogin.html">Admin</a></li>
                </ul>
            </nav>
            <p class="mt-3">Create an account or login to start your journey.</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1 class="display-5">Your Pins</h1>
            <p class="lead">Browse and manage all your saved map pins below.</p>
        </div>

        <!-- List of Pins -->
        <ul class="list-group" id="pinList">
            <!-- Dynamic pin items will be injected here -->
        </ul>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', async function() {
            const pinList = document.getElementById('pinList');

            try {
                const querySnapshot = await getDocs(collection(db, 'pins'));
                if (querySnapshot.empty) {
                    const emptyItem = document.createElement('li');
                    emptyItem.className = 'list-group-item text-muted text-center';
                    emptyItem.textContent = 'No pins created yet.';
                    pinList.appendChild(emptyItem);
                } else {
                    querySnapshot.forEach(doc => {
                        const pin = doc.data();
                        const li = document.createElement('li');
                        li.className = 'list-group-item d-flex justify-content-between align-items-center';

                        const title = document.createElement('span');
                        title.className = 'pin-title';
                        title.textContent = pin.title || 'Untitled Pin';
                        li.appendChild(title);

                        const actions = document.createElement('div');
                        actions.className = 'pin-actions';
                        const viewBtn = document.createElement('a');
                        viewBtn.href = '#';
                        viewBtn.className = 'btn btn-sm btn-outline-primary me-2';
                        viewBtn.textContent = 'View';
                        viewBtn.addEventListener('click', () => {
                            // Navigate to map view with pin coordinates
                            window.location.href = `map.html?lat=${pin.latitude}&lng=${pin.longitude}`;
                        });
                        actions.appendChild(viewBtn);

                        const editBtn = document.createElement('a');
                        editBtn.href = '#';
                        editBtn.className = 'btn btn-sm btn-outline-secondary';
                        editBtn.textContent = 'Edit';
                        // TODO: Attach edit handler
                        actions.appendChild(editBtn);

                        li.appendChild(actions);
                        pinList.appendChild(li);
                    });
                }
            } catch (error) {
                console.error('Error fetching pins:', error);
                const errorItem = document.createElement('li');
                errorItem.className = 'list-group-item text-danger text-center';
                errorItem.textContent = 'Failed to load pins.';
                pinList.appendChild(errorItem);
            }
        });
    </script>
    <!-- Bootstrap JS Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>